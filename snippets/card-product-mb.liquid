{% comment %}
  Renders a product card

  Accepts:
  - collection: {Object Collection}
  - card_product: {Object} Product Liquid object (optional)
  - media_aspect_ratio: {String} Size of the product image card. Values are "square" and "portrait". Default is "square" (optional)
  - show_secondary_image: {Boolean} Show the secondary image on hover. Default: false (optional)
  - extend_height: {Boolean} Card height extends to available container space. Default: true (optional)
  - lazy_load: {Boolean} Image should be lazy loaded. Default: true (optional)
  - section_id: {String} The ID of the section that contains this card.
  - button_color :string

  Usage:
{% endcomment %}

{{ 'component-rating.css' | asset_url | stylesheet_tag }}

{%- if card_product and card_product != empty -%}
  {%- liquid
    assign ratio = 1
    if card_product.featured_media and media_aspect_ratio == 'portrait'
      assign ratio = 0.8
    elsif card_product.featured_media and media_aspect_ratio == 'adapt'
      assign ratio = card_product.featured_media.aspect_ratio
    endif
    if ratio == 0 or ratio == null
      assign ratio = 1
    endif
  -%}
  <div class="h-full flex flex-col gap-2 lg:gap-5">
    <div class="h-40 lg:h-[300px] rounded-lg relative overflow-hidden cursor-pointer">
      {%- if card_product.featured_media -%}
        <a
          href="{{ card_product.url }}"
          class="bg-white block absolute w-full h-full left-0 right-0 top-0 bottom-0 group "
        >
          {% comment %}theme-check-disable ImgLazyLoading{% endcomment %}
          <img
            class="absolute w-full h-full left-0 right-0 top-0 bottom-0 object-contain z-10"
            srcset="
              {%- if card_product.featured_media.width >= 165 -%}{{ card_product.featured_media | image_url: width: 165 }} 165w,{%- endif -%}
              {%- if card_product.featured_media.width >= 360 -%}{{ card_product.featured_media | image_url: width: 360 }} 360w,{%- endif -%}
              {%- if card_product.featured_media.width >= 533 -%}{{ card_product.featured_media | image_url: width: 533 }} 533w,{%- endif -%}
              {%- if card_product.featured_media.width >= 720 -%}{{ card_product.featured_media | image_url: width: 720 }} 720w,{%- endif -%}
              {%- if card_product.featured_media.width >= 940 -%}{{ card_product.featured_media | image_url: width: 940 }} 940w,{%- endif -%}
              {%- if card_product.featured_media.width >= 1066 -%}{{ card_product.featured_media | image_url: width: 1066 }} 1066w,{%- endif -%}
              {{ card_product.featured_media | image_url }} {{ card_product.featured_media.width }}w
            "
            src="{{ card_product.featured_media | image_url: width: 533 }}"
            sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
            alt="{{ card_product.featured_media.alt | escape }}"
            loading="lazy"
            width="{{ card_product.featured_media.width }}"
            height="{{ card_product.featured_media.height }}"
          >
          {% comment %}theme-check-enable ImgLazyLoading{% endcomment %}

          {%- if card_product.media[1] != null and show_secondary_image -%}
            <img
              class="absolute w-full h-full left-0 right-0 top-0 bottom-0 opacity-0 object-contain z-20  group-hover:opacity-100 hover:transition-opacity hover:ease-in-out hover:duration-300 hover:delay-75"
              srcset="
                {%- if card_product.media[1].width >= 165 -%}{{ card_product.media[1] | image_url: width: 165 }} 165w,{%- endif -%}
                {%- if card_product.media[1].width >= 360 -%}{{ card_product.media[1] | image_url: width: 360 }} 360w,{%- endif -%}
                {%- if card_product.media[1].width >= 533 -%}{{ card_product.media[1] | image_url: width: 533 }} 533w,{%- endif -%}
                {%- if card_product.media[1].width >= 720 -%}{{ card_product.media[1] | image_url: width: 720 }} 720w,{%- endif -%}
                {%- if card_product.media[1].width >= 940 -%}{{ card_product.media[1] | image_url: width: 940 }} 940w,{%- endif -%}
                {%- if card_product.media[1].width >= 1066 -%}{{ card_product.media[1] | image_url: width: 1066 }} 1066w,{%- endif -%}
                {{ card_product.media[1] | image_url }} {{ card_product.media[1].width }}w
              "
              src="{{ card_product.media[1] | image_url: width: 533 }}"
              sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
              alt=""
              loading="lazy"
              width="{{ card_product.media[1].width }}"
              height="{{ card_product.media[1].height }}"
            >
          {%- endif -%}
        </a>
      {%- endif -%}

      {% comment %}
        <div class="absolute {{ settings.badge_position }}">
      {% endcomment %}
      <div class="absolute bottom-2.5 left-2.5 flex justify-center items-center z-30">
        {%- if card_product.available == false -%}
          <span
            id="Badge-{{ section_id }}-{{ card_product.id }}"
            class="py-2 px-4 font-fredasansstd text-sm font-medium rounded-full text-white color-{{ settings.sold_out_badge_color_scheme }}"
          >
            {{- 'products.product.sold_out' | t -}}
          </span>
        {%- elsif card_product.compare_at_price > card_product.price and card_product.available -%}
          <span
            id="Badge-{{ section_id }}-{{ card_product.id }}"
            class="py-2 px-4 font-fredasansstd text-sm font-medium rounded-full text-white color-{{ settings.sale_badge_color_scheme }}"
          >
            {{- 'products.product.on_sale' | t -}}
          </span>
        {%- endif -%}
      </div>
    </div>

    <div class="flex flex-col  items-start justify-start text-start min-h-[48px] gap-2 lg:flex-row lg:gap-5 lg:min-h-[60px]">
      <div class="w-full lg:w-1/2">
        <h3 class="font-medium font-fredasansstd text-dark-charcoal text-sm tracking-normal">
          <a
            href="{{ card_product.url }}"
            id="CardLink-{{ section_id }}-{{ card_product.id }}"
            aria-labelledby="CardLink-{{ section_id }}-{{ card_product.id }} Badge-{{ section_id }}-{{ card_product.id }}"
          >
            {{ card_product.title | escape }}
          </a>
        </h3>
        {% if collection %}
          <span class="text-dark-charcoal/75 font-fredasansstd font-book text-sm tracking-normal hidden lg:block">
            {{ collection.title }}
          </span>
        {% endif %}
      </div>
      <div class="w-full lg:w-1/2">
        <span class="">{{ block.settings.description | escape }}</span>
        {% render 'price-mb', product: card_product, price_class: '' %}
      </div>
    </div>
    <div class="hidden lg:block">
      <a
        href="{{ card_product.url }}"
        class="{% if button_color != blank %} {{button_color}} {% else %}bg-dark-charcoal{% endif %}  text-white tracking-wider transition ease-in-out duration-300 py-5 px-8 lg:py-5 lg:px-12 inline-flex justify-center rounded-full  text-sm font-bold font-fredasansstd mx-auto mb-7  lg:m-0 lg:mr-auto cursor-pointer hover:bg-rich-electric-blue hover:text-white"
      > 
        Consíguelo ya
      </a>
    </div>
  </div>
{%- else -%}
  <div class="h-full flex flex-col gap-2 lg:gap-5">
    <div class="h-40 lg:h-[300px] rounded-lg relative overflow-hidden">
      {{
        'product-2'
        | placeholder_svg_tag: 'bg-anti-flash-white fill-dark-charcoal block absolute w-full h-full left-0 right-0 top-0 bottom-0 '
      }}
    </div>
    <div class="flex flex-col  items-start justify-start text-start min-h-[48px] gap-2 lg:flex-row lg:gap-5 lg:min-h-[60px]">
      <div class="w-full lg:w-1/2">
        <h3 class="font-medium font-fredasansstd text-dark-charcoal text-sm">
          <a role="link" aria-disabled="true">
            {{ 'onboarding.product_title' | t }}
          </a>
        </h3>
        <span class="text-dark-charcoal/75 font-fredasansstd font-book text-sm hidden lg:block">Nueva Colección</span>
      </div>
      <div class="w-full lg:w-1/2">
        {% render 'price-mb' %}
      </div>
    </div>
    <div class="hidden lg:block">
      <a
        class="bg-dark-charcoal text-white tracking-normal transition ease-in-out duration-300 py-5 px-8 lg:py-5 lg:px-12 inline-flex justify-center rounded-full  text-sm font-bold font-fredasansstd mx-auto mb-7  lg:m-0 lg:mr-auto cursor-pointer hover:bg-rich-electric-blue hover:text-white"
      >
        Consíguelo ya
      </a>
    </div>
  </div>
{%- endif -%}
