{% comment %}
  Renders a product media gallery. Should be used with 'media-gallery.js'
  Also see 'product-media-modal'

  Accepts:
  - product: {Object} Product liquid object
  - variant_images: {Array} Product images associated with a variant
  - is_duplicate: {Boolean} Prevents rendering uneeded elements and duplicate ids for subsequent instances

  Usage:
  {% render 'product-media-gallery', is_duplicate: true %}
{% endcomment %}

{{ 'photoswipe.css' | asset_url | stylesheet_tag }}

{%- liquid
  if section.settings.hide_variants and variant_images.size == product.media.size
    assign single_media_visible = true
  endif

  assign media_count = product.media.size
  if section.settings.hide_variants and media_count > 1 and variant_images.size > 0
    assign media_count = media_count | minus: variant_images.size | plus: 1
  endif

  if media_count == 1 or single_media_visible
    assign single_media_visible_mobile = true
  endif

  if media_count == 0 or single_media_visible_mobile or section.settings.mobile_thumbnails == 'show' or section.settings.mobile_thumbnails == 'columns' and media_count < 3
    assign hide_mobile_slider = true
  endif

  assign id_append = ''
  if is_duplicate
    assign id_append = '-duplicate'
  endif
-%}

{%- if media_count > 1
  and section.settings.gallery_layout contains 'thumbnail'
  or section.settings.mobile_thumbnails == 'show'
-%}
  <div class="swiper mySwiper2 w-full h-80 lg:pt-8 gallery-photoswipe pswp-gallery">
    <div class="swiper-wrapper">
      {%- for media in product.media -%}
        <div class="swiper-slide cursor-pointer">
          <a
            class="gallery-item-photo bg-white w-full h-full relative block"
            href="{{ media | image_url: width: 2500, height: 2500 }}"
            data-pswp-width="2500" 
            data-pswp-height="2500"
            target="_blank"
          >
            {{
              media
              | image_url: width: 460
              | image_tag: class: 'absolute left-0 top-0 right-0 bottom-0 object-contain h-full w-full', loading: 'lazy'
            }}
          </a>
        </div>
      {%- endfor -%}
    </div>
  </div>
{%- endif -%}
{%- if media_count > 1
  and section.settings.gallery_layout contains 'thumbnail'
  or section.settings.mobile_thumbnails == 'show'
-%}
  <div thumbsSlider="" class="swiper mySwiper mt-4">
    <div class="swiper-wrapper">
      {%- for media in product.media -%}
        <div class="swiper-slide w-24 h-16 cursor-pointer">
          <div class="bg-white relative w-full h-full">
            {{
              media
              | image_url: width: 200
              | image_tag: class: 'object-contain h-full w-full absolute left-0 top-0 right-0 bottom-0', loading: 'lazy'
            }}
          </div>
        </div>
      {%- endfor -%}
    </div>
  </div>
{%- endif -%}
{%- if media_count > 1
  and section.settings.gallery_layout contains 'thumbnail'
  or section.settings.mobile_thumbnails == 'show'
-%}


  <!-- Initialize Swiper -->
  <script>
    window.addEventListener('load', function () {
      var swiper = new Swiper('.mySwiper', {
        spaceBetween: 10,
        slidesPerView: 'auto',
        freeMode: true,
        watchSlidesProgress: true,
      });
      var swiper2 = new Swiper('.mySwiper2', {
        spaceBetween: 10,
        thumbs: {
          swiper: swiper,
        },
      });
    });
  </script>
  <script type="module">
    import PhotoSwipeLightbox from '{{ 'photoswipe-lightbox.esm.js' | asset_url }}';
    const lightbox = new PhotoSwipeLightbox({
      gallery: '.gallery-photoswipe',
      children: '.gallery-item-photo',
      pswpModule: () => import('{{ 'photoswipe.esm.js' | asset_url }}')
    });
    lightbox.init();
    </script>
{%- endif -%}
